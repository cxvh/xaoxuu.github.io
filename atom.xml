<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>XAOXUU</title>
  
  
  <link href="https://xaoxuu.com/atom.xml" rel="self"/>
  
  <link href="https://xaoxuu.com/"/>
  <updated>2021-02-19T01:56:28.304Z</updated>
  <id>https://xaoxuu.com/</id>
  
  <author>
    <name>xaoxuu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>如何搭建一个脚本库，直接调用云端脚本</title>
    <link href="https://xaoxuu.com/blog/2021-01-02-shell/"/>
    <id>https://xaoxuu.com/blog/2021-01-02-shell/</id>
    <published>2021-01-01T16:00:00.000Z</published>
    <updated>2021-02-19T01:56:28.304Z</updated>
    
    <content type="html"><![CDATA[<p>细心的朋友可能会发现，我提供的一些脚本都可以通过一行命令安装，并且它们的安装命令极为相似，本文探讨是否可以把这套体系升级成为方便所有人发布脚本与下载脚本的开放性平台。</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -s https:&#x2F;&#x2F;xaoxuu.com&#x2F;install | sh -s vim-cn.sh</span><br><span class="line">curl -s https:&#x2F;&#x2F;xaoxuu.com&#x2F;install | sh -s tag.sh</span><br><span class="line">curl -s https:&#x2F;&#x2F;xaoxuu.com&#x2F;install | sh -s hexo.sh</span><br><span class="line">curl -s https:&#x2F;&#x2F;xaoxuu.com&#x2F;install | sh -s podspec.sh</span><br></pre></td></tr></table></figure><p>虽然它们安装方式极为相似，但是安装逻辑却并非完全相同，例如前三者是安装到 <code>/usr/local/bin/</code> 目录下，在任意位置打开终端都可以使用，而  <code>podspec.sh</code> 则是下载到当前目录下。</p><p>如果打开 <code>https://xaoxuu.com/install</code> 文件，你会发现它并没有做任何实质性的操作，只是负责任务派发，根据不同的参数把「安装」指令指派给不同的项目，不同的项目对「安装」的具体实现可以相同也可以不同。</p><p>对于相同的部分，以 <code>vim-cn.sh</code> 为例，它的 <code>install</code> 实现如下：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 这个脚本负责下载和安装的逻辑</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># function lib</span></span><br><span class="line">lib=https://cdn.jsdelivr.net/gh/xaoxuu/lib.sh@2.0</span><br><span class="line"><span class="comment"># repository name</span></span><br><span class="line">REPO=<span class="string">&#x27;vim-cn.sh&#x27;</span></span><br><span class="line"><span class="comment"># clint file name</span></span><br><span class="line">TARGET=<span class="string">&#x27;cli.sh&#x27;</span></span><br><span class="line"><span class="comment"># clint file name</span></span><br><span class="line">RENAME=<span class="string">&#x27;upload&#x27;</span></span><br><span class="line"><span class="comment"># download version</span></span><br><span class="line">VERSION=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$VERSION</span>&quot;</span> == <span class="string">&quot;&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    VERSION=<span class="string">&#x27;master&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">on_success</span></span>() &#123;</span><br><span class="line">    doc_url=https://xaoxuu.com/wiki/<span class="variable">$&#123;REPO&#125;</span>/</span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;\n&gt; \033[32m恭喜您，安装成功！\033[0m 请收藏这个页面，在您遇到问题的时候可以查看文档：\n<span class="variable">$&#123;doc_url&#125;</span>\n\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">curl -s <span class="variable">$&#123;lib&#125;</span>/download.sh | sh -s xaoxuu <span class="variable">$&#123;REPO&#125;</span> <span class="variable">$&#123;VERSION&#125;</span> <span class="variable">$&#123;TARGET&#125;</span> &amp;&amp;</span><br><span class="line">curl -s <span class="variable">$&#123;lib&#125;</span>/install.sh | sh -s <span class="variable">$HOME</span>/Downloads/<span class="variable">$&#123;TARGET&#125;</span> <span class="variable">$&#123;RENAME&#125;</span> &amp;&amp; on_success</span><br></pre></td></tr></table></figure><p>从中可以看到它导入了一个「库」，确切的说是一个存放可复用代码的仓库地址，具体的「下载」与「安装」脚本像独立组件一样可供外部调用。与此例不同的 <code>podspec.sh</code> 脚本就只有下载操作：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -s <span class="variable">$&#123;lib&#125;</span>/download.sh | sh -s xaoxuu <span class="variable">$&#123;REPO&#125;</span> <span class="variable">$&#123;VERSION&#125;</span> <span class="variable">$&#123;TARGET&#125;</span> ./ &amp;&amp;</span><br><span class="line">chmod 777 <span class="variable">$&#123;TARGET&#125;</span> &amp;&amp; on_success</span><br></pre></td></tr></table></figure><h2 id="易于扩展"><a href="#易于扩展" class="headerlink" title="易于扩展"></a>易于扩展</h2><p>这么一套流程使得脚本安装变得非常有扩展性，如果需要发布一个新的脚本，只需要新建仓库，在其中写一个 <code>install</code> 脚本，通过调用 <code>lib.sh</code> 仓库里封装好的脚本，传入仓库名、版本、要下载的文件，就可以轻松实现下载安装流程。</p><h2 id="易于使用"><a href="#易于使用" class="headerlink" title="易于使用"></a>易于使用</h2><p>更重要的是，可以通过一行命令来安装：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -s https:&#x2F;&#x2F;xaoxuu.com&#x2F;install | sh -s 我的脚本</span><br></pre></td></tr></table></figure><p>这套体系类似于「应用商店、Cocoapods、npm」一样，但目前只对创建在 <code>https://github.com/xaoxuu/</code> 中的仓库有效。</p><h2 id="Todo"><a href="#Todo" class="headerlink" title="Todo"></a>Todo</h2><ol><li>把「扩展性」范围放大至所有GitHub用户的仓库，而不是只有我自己账号下的仓库。</li><li>为 lib 库增加更多基础组件。</li><li>需要懂脚本的大佬完成跨平台兼容性（Win/Mac/Linux）</li><li>修复现存问题，例如 <code>volantis/start</code> 首次安装后无限循环的BUG</li><li>如果可能，建一个前端页面可供搜索、查阅文档。</li><li>社区、推广，让更多人加入。</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;细心的朋友可能会发现，我提供的一些脚本都可以通过一行命令安装，并且它们的安装命令极为相似，本文探讨是否可以把这套体系升级成为方便所有人发布脚本与下载脚本的开放性平台。&lt;/p&gt;</summary>
    
    
    
    <category term="奇思妙想" scheme="https://xaoxuu.com/blog/categories/%E5%A5%87%E6%80%9D%E5%A6%99%E6%83%B3/"/>
    
    
    <category term="shell" scheme="https://xaoxuu.com/blog/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>苹果线上活动《为 iPhone 和 iPad 搭建灵活适配的用户界面》</title>
    <link href="https://xaoxuu.com/blog/2020-11-19-ios-layout/"/>
    <id>https://xaoxuu.com/blog/2020-11-19-ios-layout/</id>
    <published>2020-11-18T16:00:00.000Z</published>
    <updated>2021-02-20T10:38:02.208Z</updated>
    
    <content type="html"><![CDATA[<p>受疫情影响，今年设计开发加速器活动改为线上形式，本次参与的活动课题是《为 iPhone 和 iPad 搭建灵活适配的用户界面》，新出的几款 iPhone 和 iPad 设备尺寸和旧设备都不同，造成适配成本增加，本次活动目的是向开发者分享高效而灵活的适配方案。</p><a id="more"></a><h2 id="避免屏幕分辨率硬编码"><a href="#避免屏幕分辨率硬编码" class="headerlink" title="避免屏幕分辨率硬编码"></a>避免屏幕分辨率硬编码</h2><p>常见陷阱：对硬件设备型号做特殊判断</p><h2 id="适配方面"><a href="#适配方面" class="headerlink" title="适配方面"></a>适配方面</h2><ul><li>启动屏</li><li>安全区和布局边框</li><li>尺寸类</li><li>动态字体</li></ul><h3 id="启动屏"><a href="#启动屏" class="headerlink" title="启动屏"></a>启动屏</h3><p>用 Storyboard 启动屏，不建议用图片作为启动页。</p><blockquote><p>详见 <a href="https://developer.apple.com/design/human-interface-guidelines/ios/app-architecture/launching/">Human Interface Guidelines -&gt; Launch Screen</a></p></blockquote><h3 id="安全区和布局边框"><a href="#安全区和布局边框" class="headerlink" title="安全区和布局边框"></a>安全区和布局边框</h3><p><strong>安全区</strong></p><p>UIScreen &amp; UIWindow 获得布局尺寸进行排版不适用于 iPhone X 以及以后机型</p><p>要使用安全区来进行布局（安全区是动态的，不同设备、横竖屏、子视图都不相同）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.safeAreaInsets</span><br><span class="line">.safeAreaLayoutGuide</span><br></pre></td></tr></table></figure><p>还可以根据需要定制安全区（例如定制工具栏）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.additionalSafeAreaInsets</span><br></pre></td></tr></table></figure><p>安全区发生变化时：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.viewSafeAreaInsetsDidChange()</span><br></pre></td></tr></table></figure><p><strong>布局边框</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.layoutMargins</span><br><span class="line">.directionalLayoutMargins</span><br><span class="line">.layoutMarginsGuide</span><br><span class="line">.layoutMarginsDidChange()</span><br></pre></td></tr></table></figure><p>与安全区配合使用</p><p>子视图传递</p><p>布局边框会根据设备宽度、动态字体而自动调整，能够自动适配。</p><h3 id="尺寸类"><a href="#尺寸类" class="headerlink" title="尺寸类"></a>尺寸类</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sizeClasses</span><br></pre></td></tr></table></figure><ul><li>C 紧凑型（iPhone竖屏，iPad分屏）</li><li>R 常规型（iPad竖屏，12.9‘iPad等宽分屏）</li></ul><h3 id="动态字体"><a href="#动态字体" class="headerlink" title="动态字体"></a>动态字体</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.large</span><br><span class="line">.title1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">label.font &#x3D; UIFont.preferred...</span><br></pre></td></tr></table></figure><p><strong>自定义字体</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">metrics &#x3D; UIFontMetrics(...)</span><br></pre></td></tr></table></figure><blockquote><p>more at WWDC2017</p></blockquote><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><div class="tag-plugin timeline"><svg class="icon top" width="1em" height="1em" viewBox="0 0 14 14" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">  <path d="M7,0 C3.13425,0 0,3.13425 0,7 C0,10.86575 3.13425,14 7,14 C10.86575,14 14,10.86575 14,7 C14,3.13425 10.86575,0 7,0 Z M7,12.25 C4.104625,12.25 1.75,9.89449999 1.75,7 C1.75,4.10550001 4.104625,1.75 7,1.75 C9.895375,1.75 12.25,4.10550001 12.25,7 C12.25,9.89449999 9.895375,12.25 7,12.25 Z M8.75875001,7 L7.43750001,7 C7.19600001,7 7.00000002,6.804 7.00000002,6.56250001 L7.00000002,5.24125001 C7.00000002,4.76262501 6.61237501,4.37500001 6.13375002,4.37500001 L6.11625001,4.37500001 C5.63762502,4.37500001 5.25000001,4.76262501 5.25000001,5.24125001 L5.25000001,7.88375 C5.25000001,8.362375 5.63762502,8.75 6.11625001,8.75 L8.75875001,8.75 C9.237375,8.75 9.62500001,8.362375 9.62500001,7.88375 L9.62500001,7.86625 C9.62500001,7.387625 9.237375,7 8.75875001,7 L8.75875001,7 Z" id="top"></path></svg><div class="tag-plugin timenode"><div class="header"><span>2021年1月4日</span><a href="#comments"><svg class="icon comment" width="1em" height="1em" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">  <path d="M2.9969419,5.71559633 C2.9969419,6.20032331 3.38989075,6.59327217 3.87461774,6.59327217 C4.35934472,6.59327217 4.75229358,6.20032331 4.75229358,5.71559633 C4.75229358,5.23086935 4.35934472,4.83792049 3.87461774,4.83792049 C3.38989075,4.83792049 2.9969419,5.23086935 2.9969419,5.71559633 L2.9969419,5.71559633 Z" id="Path"></path>  <path d="M6.76452599,5.71559633 C6.76452599,6.20032331 7.15747485,6.59327217 7.64220183,6.59327217 C8.12692882,6.59327217 8.51987768,6.20032331 8.51987768,5.71559633 C8.51987768,5.23086935 8.12692882,4.83792049 7.64220183,4.83792049 C7.15747485,4.83792049 6.76452599,5.23086935 6.76452599,5.71559633 L6.76452599,5.71559633 Z" id="Path"></path>  <path d="M10.5321101,5.71559633 C10.5321101,6.20032331 10.925059,6.59327217 11.4097859,6.59327217 C11.8945129,6.59327217 12.2874618,6.20032331 12.2874618,5.71559633 C12.2874618,5.23086935 11.8945129,4.83792049 11.4097859,4.83792049 C10.925059,4.83792049 10.5321101,5.23086935 10.5321101,5.71559633 L10.5321101,5.71559633 Z" id="Path"></path>  <path d="M7.60209315,13.9999855 L7.55255823,13.9999855 C7.30643038,13.9884675 7.07504521,13.8795376 6.90961525,13.6972904 L4.89384746,11.4483761 L1.65891421,11.4483761 C0.743346584,11.4478203 0.00111501673,10.7074957 6.1284311e-14,9.79372406 L6.1284311e-14,1.65465205 C0.00111501673,0.740880414 0.743346584,0.000555821957 1.65891421,0 L13.5877306,0 C14.5013239,0.00333115 15.2404835,0.742844925 15.2415902,1.65465205 L15.2415902,9.82701889 C15.2251033,10.7277804 14.490407,11.4502791 13.5877306,11.4534208 L10.271924,11.4534208 L8.2976038,13.6892189 C8.27421324,13.715602 8.24923084,13.7405354 8.22279597,13.7638801 C8.05262919,13.9170682 7.83125236,14.0012711 7.60209315,13.9999855 L7.60209315,13.9999855 Z M1.66396879,1.21475675 C1.41971289,1.21474108 1.22092389,1.41089082 1.21815455,1.65465205 L1.21815455,9.78968833 C1.21926521,10.0347976 1.41837601,10.2330673 1.66396879,10.2336194 L5.44075337,10.2336194 L7.60007132,12.6520346 L9.72299626,10.2467355 L13.5877306,10.2467355 C13.8298342,10.2462637 14.0275201,10.0534394 14.0335448,9.81188488 L14.0335448,1.65465205 C14.0329874,1.4093126 13.8335527,1.21072101 13.5877306,1.21072101 L1.66396879,1.21475675 Z" id="comment"></path></svg></a></div><div class="body"><p>今天收到 Apple 的邮件，设计开发加速器活动现在已经开放申请啦，感兴趣的朋友们可以去<a href="https://developer.apple.com/cn/accelerator/">官网</a>申请。</p></div></div><div class="tag-plugin timenode"><div class="header"><span>2021年2月1日</span><a href="#comments"><svg class="icon comment" width="1em" height="1em" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">  <path d="M2.9969419,5.71559633 C2.9969419,6.20032331 3.38989075,6.59327217 3.87461774,6.59327217 C4.35934472,6.59327217 4.75229358,6.20032331 4.75229358,5.71559633 C4.75229358,5.23086935 4.35934472,4.83792049 3.87461774,4.83792049 C3.38989075,4.83792049 2.9969419,5.23086935 2.9969419,5.71559633 L2.9969419,5.71559633 Z" id="Path"></path>  <path d="M6.76452599,5.71559633 C6.76452599,6.20032331 7.15747485,6.59327217 7.64220183,6.59327217 C8.12692882,6.59327217 8.51987768,6.20032331 8.51987768,5.71559633 C8.51987768,5.23086935 8.12692882,4.83792049 7.64220183,4.83792049 C7.15747485,4.83792049 6.76452599,5.23086935 6.76452599,5.71559633 L6.76452599,5.71559633 Z" id="Path"></path>  <path d="M10.5321101,5.71559633 C10.5321101,6.20032331 10.925059,6.59327217 11.4097859,6.59327217 C11.8945129,6.59327217 12.2874618,6.20032331 12.2874618,5.71559633 C12.2874618,5.23086935 11.8945129,4.83792049 11.4097859,4.83792049 C10.925059,4.83792049 10.5321101,5.23086935 10.5321101,5.71559633 L10.5321101,5.71559633 Z" id="Path"></path>  <path d="M7.60209315,13.9999855 L7.55255823,13.9999855 C7.30643038,13.9884675 7.07504521,13.8795376 6.90961525,13.6972904 L4.89384746,11.4483761 L1.65891421,11.4483761 C0.743346584,11.4478203 0.00111501673,10.7074957 6.1284311e-14,9.79372406 L6.1284311e-14,1.65465205 C0.00111501673,0.740880414 0.743346584,0.000555821957 1.65891421,0 L13.5877306,0 C14.5013239,0.00333115 15.2404835,0.742844925 15.2415902,1.65465205 L15.2415902,9.82701889 C15.2251033,10.7277804 14.490407,11.4502791 13.5877306,11.4534208 L10.271924,11.4534208 L8.2976038,13.6892189 C8.27421324,13.715602 8.24923084,13.7405354 8.22279597,13.7638801 C8.05262919,13.9170682 7.83125236,14.0012711 7.60209315,13.9999855 L7.60209315,13.9999855 Z M1.66396879,1.21475675 C1.41971289,1.21474108 1.22092389,1.41089082 1.21815455,1.65465205 L1.21815455,9.78968833 C1.21926521,10.0347976 1.41837601,10.2330673 1.66396879,10.2336194 L5.44075337,10.2336194 L7.60007132,12.6520346 L9.72299626,10.2467355 L13.5877306,10.2467355 C13.8298342,10.2462637 14.0275201,10.0534394 14.0335448,9.81188488 L14.0335448,1.65465205 C14.0329874,1.4093126 13.8335527,1.21072101 13.5877306,1.21072101 L1.66396879,1.21475675 Z" id="comment"></path></svg></a></div><div class="body"><p>今天无意中发现又关闭申请入口了。</p></div></div><svg class="icon bottom" width="1em" height="1em" viewBox="0 0 14 14" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7,0 C10.8558804,0.0243061403 13.9756939,3.14411956 14,7 C14,10.8659932 10.8659932,14 7,14 C3.13400675,14 0,10.8659932 0,7 C0,3.13400675 3.13400675,0 7,0 Z M7,1.27272727 C4.67984382,1.25597015 2.57881097,2.64070073 1.67929035,4.77945461 C0.779769726,6.91820849 1.25950821,9.38836411 2.89419242,11.0349403 C4.52887664,12.6815164 6.99549008,13.1791467 9.14070778,12.2951521 C11.2859255,11.4111574 12.6859091,9.32021669 12.6859091,7 C12.6739296,3.85798179 10.1418488,1.30748075 7,1.27272727 Z M2.70454544,7 C2.7044994,7.39789465 2.91674722,7.76558417 3.26132643,7.96454478 C3.60590563,8.1635054 4.030458,8.1635054 4.3750372,7.96454478 C4.7196164,7.76558417 4.93186422,7.39789465 4.93181818,7 C4.93186422,6.60210535 4.7196164,6.23441583 4.3750372,6.03545522 C4.030458,5.8364946 3.60590563,5.8364946 3.26132643,6.03545522 C2.91674722,6.23441583 2.7044994,6.60210535 2.70454544,7 L2.70454544,7 Z M5.88636363,7 C5.88636363,7.39786396 6.09862151,7.76550543 6.44318181,7.96443741 C6.7877421,8.1633694 7.2122579,8.1633694 7.55681819,7.96443741 C7.90137849,7.76550543 8.11363637,7.39786396 8.11363637,7 C8.11363637,6.38495562 7.61504438,5.88636363 7,5.88636363 C6.38495562,5.88636363 5.88636363,6.38495562 5.88636363,7 L5.88636363,7 Z M9.06818182,7 C9.06813578,7.39789465 9.2803836,7.76558417 9.6249628,7.96454478 C9.969542,8.1635054 10.3940944,8.1635054 10.7386736,7.96454478 C11.0832528,7.76558417 11.2955006,7.39789465 11.2954546,7 C11.2955006,6.60210535 11.0832528,6.23441583 10.7386736,6.03545522 C10.3940944,5.8364946 9.969542,5.8364946 9.6249628,6.03545522 C9.2803836,6.23441583 9.06813578,6.60210535 9.06818182,7 Z" id="bottom"></path></svg></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;受疫情影响，今年设计开发加速器活动改为线上形式，本次参与的活动课题是《为 iPhone 和 iPad 搭建灵活适配的用户界面》，新出的几款 iPhone 和 iPad 设备尺寸和旧设备都不同，造成适配成本增加，本次活动目的是向开发者分享高效而灵活的适配方案。&lt;/p&gt;</summary>
    
    
    
    <category term="技术简讯" scheme="https://xaoxuu.com/blog/categories/%E6%8A%80%E6%9C%AF%E7%AE%80%E8%AE%AF/"/>
    
    
    <category term="iOS" scheme="https://xaoxuu.com/blog/tags/ios/"/>
    
  </entry>
  
  <entry>
    <title>如何使用手机摄像头测量心率</title>
    <link href="https://xaoxuu.com/blog/2020-09-27-heartrate/"/>
    <id>https://xaoxuu.com/blog/2020-09-27-heartrate/</id>
    <published>2020-09-26T16:00:00.000Z</published>
    <updated>2021-02-18T02:20:05.955Z</updated>
    
    <content type="html"><![CDATA[<p>在心率管家默默无闻地上线了一年多之后，现在终于打算来好好聊聊关于手机摄像头测量心率的那些事。本文参考了很多前辈的文章，将在文末列出。</p><a id="more"></a><div class="tag-plugin video-wrap"><div class="frame-wrap" id="iphone11"focus="top"><video poster="https://7.dusays.com/2020/09/28/baa33914a34ec.jpg" playsinline="" muted="" loop="" autoplay="" preload="metadata"><source src="https://7.dusays.com/2020/09/28/39db723f1e200.mp4" type="video/mp4"></video><div class="frame"></div></div></div><h2 id="光电容积脉搏波描记法"><a href="#光电容积脉搏波描记法" class="headerlink" title="光电容积脉搏波描记法"></a>光电容积脉搏波描记法</h2><p>目前市面上大部分便携心率检测设备都是基于光电容积脉搏波描记法来测量的。由于心跳引起动脉周期性变化，动脉内血液的容积发生周期性变化，因而对光线的吸收也会呈现同样的周期性变化，这个周期性变化的频率就是脉率，脉率大部分情况都和心率一致。</p><p>打开相机，把手指指尖覆盖在摄像头上，观察屏幕上的取景框，就可以发现每心跳一次，屏幕中的红色都会变暗一次。对每一帧画面提取 RGB 均值，并转换到 HSV 色彩空间，把色相 H 作为特征值，得到时域信号。</p><h2 id="信号处理"><a href="#信号处理" class="headerlink" title="信号处理"></a>信号处理</h2><p>我使用简单的时域分析法计算脉率，关键点就是计算采样时间内的波峰个数。把色相信号绘制波形图如下：</p><div class="tag-plugin img-wrap"><div class="img-bg" style="background:#fff"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0927a@2x.jpg" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0927a@2x.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="width:300px;padding:8px;"/></div></div><p>由于覆盖力度不稳定导致色相会整体偏移因而产生低频噪声，再加原本就存在的高频噪声影响，波形显得很杂乱无章，所以使用带通递归滤波器进行滤波：</p><p><img src="https://7.dusays.com/2020/09/27/5ac0064c05e2d.svg" class="lazyload" data-srcset="https://7.dusays.com/2020/09/27/5ac0064c05e2d.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>公式展开为：</p><p><img src="https://7.dusays.com/2020/09/27/8eb5058d3577f.svg" class="lazyload" data-srcset="https://7.dusays.com/2020/09/27/8eb5058d3577f.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>用 Swift 语言实现这个滤波器的算法（10阶）为：</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">BandpassFilter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> x = [<span class="type">CGFloat</span>].<span class="keyword">init</span>(repeating: <span class="number">0</span>, <span class="built_in">count</span>: <span class="number">11</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> y = [<span class="type">CGFloat</span>].<span class="keyword">init</span>(repeating: <span class="number">0</span>, <span class="built_in">count</span>: <span class="number">11</span>)</span><br><span class="line">    <span class="meta">@discardableResult</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">filted</span><span class="params">(<span class="number">_</span> value: CGFloat)</span></span> -&gt; <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> x.<span class="built_in">count</span> &gt; <span class="number">10</span>, y.<span class="built_in">count</span> &gt; <span class="number">10</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span> ..&lt; <span class="number">10</span> &#123;</span><br><span class="line">            x[i] = x[i+<span class="number">1</span>]</span><br><span class="line">            y[i] = y[i+<span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        x[<span class="number">10</span>] = value / <span class="number">1.894427025e</span>+<span class="number">01</span></span><br><span class="line">        y[<span class="number">10</span>] = x[<span class="number">10</span>] - x[<span class="number">0</span>] + <span class="number">5</span> * (x[<span class="number">2</span>] - x[<span class="number">8</span>]) + <span class="number">10</span> * (x[<span class="number">6</span>] - x[<span class="number">4</span>])</span><br><span class="line">        y[<span class="number">10</span>] += (-<span class="number">0.0000000000</span> * y[<span class="number">0</span>]) + (<span class="number">0.0357796363</span> * y[<span class="number">1</span>])</span><br><span class="line">        y[<span class="number">10</span>] += (-<span class="number">0.1476158522</span> * y[<span class="number">2</span>]) + (<span class="number">0.3992561394</span> * y[<span class="number">3</span>])</span><br><span class="line">        y[<span class="number">10</span>] += (-<span class="number">1.1743136181</span> * y[<span class="number">4</span>]) + (<span class="number">2.4692165842</span> * y[<span class="number">5</span>])</span><br><span class="line">        y[<span class="number">10</span>] += (-<span class="number">3.3820859632</span> * y[<span class="number">6</span>]) + (<span class="number">3.9628972812</span> * y[<span class="number">7</span>])</span><br><span class="line">        y[<span class="number">10</span>] += (-<span class="number">4.3832594900</span> * y[<span class="number">8</span>]) + (<span class="number">3.2101976096</span> * y[<span class="number">9</span>])</span><br><span class="line">        <span class="keyword">return</span> y[<span class="number">10</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这个算法是从 <a href="https://github.com/WuXiaoTu/HeartRate">WuXiaoTu/HeartRate</a> 这个开源库中翻译来的，由于滤波效果已经满足需求了，我就没有去修改滤波参数。</p></blockquote><p>经过滤波之后就能看到波形图呈现锯齿状，由于这是由摄像头捕捉到的色相的波形图，所以看起来并不会像心电图那样：</p><div class="tag-plugin img-wrap"><div class="img-bg" style="background:#fff"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0927b@2x.jpg" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0927b@2x.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="width:300px;padding:8px;"/></div></div><p>有了干净的波形图，就可以数出一段时间内的波峰个数，从而计算出频率。例如数5秒内有多少个波峰，然后乘以12就是每分钟脉搏跳动次数，也就是这5秒内的平均脉率。现在 GitHub 上的很多同类的开源项目也都是这种方案。由于连续测量的时间越长，发生中断的可能性就越大，测量成功率就越低，再考虑到心率本身就是变化的，时间跨度太长也会使得数据变得没有意义，测量时间太短又很容易被个别误差数据影响。</p><p>网络上现有方案都是先确定测量时长，时间结束后计算结果：</p><ul><li>如果测量时间短：成功率高，准确性低。</li><li>如果测量时间中等：成功率低，准确性高。</li><li>如果测量时间长：成功率很低，准确性很高，但是数据意义不大。</li></ul><p>我想出了一种新的方案，就是每探测到一个有效脉冲，就记录下这个脉冲与上一个有效脉冲之间的间隔，两个连续的有效脉冲计算出来的频率就是100%正确的瞬时脉率。所以改进后的方案是：开始测量后，始终记录脉冲，随时可以计算瞬时脉率、最后若干秒的平均脉率。</p><ul><li>成功率：100%（不存在测量中断而失败的情况）</li><li>准确性的情况如下：<ul><li>如果脉冲计数都是由脉搏跳动引起的，测量结果就是完全准确的</li><li>如果脉搏跳动了而脉冲计数没有增加，不会影响结果，因为计算时只会把有效脉冲的周期进行累加</li><li>如果在脉搏跳动间隙额外增加了脉冲计数，那么数据就会失真</li></ul></li></ul><p>如果不故意快速抖动手指，数据失真的情况就不会发生，因为手指不离开摄像头并在两次脉搏跳动中间产生一次色相饱和度明度都以假乱真的脉冲信号是很难的。</p><h3 id="脉冲探测器"><a href="#脉冲探测器" class="headerlink" title="脉冲探测器"></a>脉冲探测器</h3><p>经过滤波后的数值是围绕0上下波动的，分别记录大于0的值和小于0的值，各自保存到数组中，然后求出它们的平均值：</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> filted &gt; <span class="number">0</span> &#123;</span><br><span class="line">    upVals.append(filted)</span><br><span class="line">    <span class="keyword">if</span> upVals.<span class="built_in">count</span> &gt; <span class="number">20</span> &#123;</span><br><span class="line">        upVals.removeFirst(upVals.<span class="built_in">count</span> - <span class="number">20</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> filted &lt; <span class="number">0</span> &#123;</span><br><span class="line">    downVals.append(filted)</span><br><span class="line">    <span class="keyword">if</span> downVals.<span class="built_in">count</span> &gt; <span class="number">20</span> &#123;</span><br><span class="line">        downVals.removeFirst(downVals.<span class="built_in">count</span> - <span class="number">20</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> avgUp = upVals.<span class="built_in">reduce</span>(<span class="number">0</span>, +) / <span class="type">CGFloat</span>(upVals.<span class="built_in">count</span>)</span><br><span class="line"><span class="keyword">let</span> avgDown = downVals.<span class="built_in">reduce</span>(<span class="number">0</span>, +) / <span class="type">CGFloat</span>(downVals.<span class="built_in">count</span>)</span><br></pre></td></tr></table></figure><p>如果新的值高于 <code>avgUp</code> 的一半，就标记 <code>flag = true</code> ，低于 <code>avgDown</code> 的一半且 <code>flag = true</code> 就标记 <code>flag = true</code>，触发一次脉冲，记录下这个脉冲的时间戳。如果两个脉冲之间的时间间隔符合正常心率的范围，就认为是有效脉冲。</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> filted &gt; <span class="number">0.5</span> * avgUp  &#123;</span><br><span class="line">    flag = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> filted &lt; <span class="number">0.5</span> * avgDown &amp;&amp; flag == <span class="literal">true</span> &#123;</span><br><span class="line">    flag = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">let</span> time = <span class="type">CACurrentMediaTime</span>()</span><br><span class="line">    <span class="keyword">let</span> period = time - periodStart</span><br><span class="line">    <span class="comment">// 与上一个周期间隔时间满足正常周期范围</span></span><br><span class="line">    <span class="keyword">if</span> period &lt; <span class="type">MAX_PERIOD</span> &amp;&amp; period &gt; <span class="type">MIN_PERIOD</span> &#123;</span><br><span class="line">        <span class="comment">// 记录这次脉冲与上次脉冲的时间间隔</span></span><br><span class="line">        periods.append(period)</span><br><span class="line">        <span class="comment">// 捕获到脉冲</span></span><br><span class="line">        delegate?.pulseDetector(detector: <span class="keyword">self</span>, capture: periods)</span><br><span class="line">    &#125;</span><br><span class="line">    periodStart = time</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> filted</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上文「正常心率的范围」如何界定？心率如果低到 40bpm 此时周期达到最大值，如果心率高达 255bpm 则周期达到最小值。</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">MAX_PERIOD</span> = <span class="type">CFTimeInterval</span>(<span class="number">60.0</span> / <span class="number">40</span>)</span><br><span class="line"><span class="type">MIN_PERIOD</span> = <span class="type">CFTimeInterval</span>(<span class="number">60.0</span> / <span class="number">255</span>)</span><br></pre></td></tr></table></figure><h3 id="计算脉率"><a href="#计算脉率" class="headerlink" title="计算脉率"></a>计算脉率</h3><p>上一步记录下了每个脉冲的周期，取出最后 N 个要计算的脉冲，把它们的周期相加就是总时长，用 <code>个数 / 时长</code> 计算的值就是频率，频率乘以 <code>60</code> 就是每分钟的脉冲数，也就是脉率。</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calcFrequency</span><span class="params">(<span class="built_in">count</span>: Int)</span></span> -&gt; <span class="type">CGFloat?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> (<span class="number">0</span> ... periods.<span class="built_in">count</span>).<span class="built_in">contains</span>(<span class="built_in">count</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> duration = periods.<span class="built_in">dropFirst</span>(periods.<span class="built_in">count</span> - <span class="built_in">count</span>).<span class="built_in">reduce</span>(<span class="number">0</span>, +)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">CGFloat</span>(<span class="built_in">count</span>) / <span class="type">CGFloat</span>(duration)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="tag-plugin img-wrap"><div class="frame-wrap" id="iphone11"><img class="img lazyload" src="https://7.dusays.com/2020/09/27/b933c68476fa8.png" class="lazyload" data-srcset="https://7.dusays.com/2020/09/27/b933c68476fa8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/><div class="frame"></div></div></div><h2 id="准确性与参考价值"><a href="#准确性与参考价值" class="headerlink" title="准确性与参考价值"></a>准确性与参考价值</h2><p>由于心率是动态变化的，即使测量的脉搏跳动都是准确的，也就是说测量阶段实现了零误差，但是计算方式不一样也会产生不同的结果。因此直接拿结果去和小米手环或者 Apple Watch 上显示的数值去进行对比是不严谨的。正确地方法是在一个时间段内用多种方式测量的同时亲自用手测量脉搏跳动次数，可以借助本文的 demo 计算瞬时或者平均脉率，如果一段时间的脉冲计数完全正确，那么 demo 计算的结果就是完全准确的，瞬时脉率、最后 N 秒的平均脉率一般都不会相同。因此即使戴在一只手上同一时间进行测量，不同产品显示的心率不同也并不能说明它们谁更准，只能说谁的结果更具有参考价值。</p><p>对此，我优化后的心率管家测量方案可以选择测量时长，也可以随时结束测量，运动后心率变化快的时候适合取短时间内例如5s平均脉率，心平气和的时候可以取适当长一点的例如10s或者20s的平均脉率。</p><h2 id="脉率和心率"><a href="#脉率和心率" class="headerlink" title="脉率和心率"></a>脉率和心率</h2><p>脉率是每分钟脉搏的次数，心率是每分钟心跳次数，健康情况下脉率与心率一致，但是如果出现心律失常，心脏有一些跳动不能有效将血液泵至全身，因此会出现脉搏缺失，导致脉率显著低于心率。如果用来判断心脏功能状态，误差很大。对于心动过速、低血压症和休克病人，即使是心率规则，由于脉压差很小，脉搏也会很弱，此时往往不能够准确测量脉率。</p><p>另外，脉搏随肢体移动会形成伪迹波动，也会影响脉率的测量。而心率不受心律失常、心动过速、休克、肢体活动的影响，所以在临床上，医生判断心跳活动不是看脉率，而是看心率，摸脉搏只是一个辅助操作。</p><p>因此，通过手环、手表、app 测量的“心率”并不是一个完全可靠的数据。</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>非常感谢 <a href="https://lifestyle1.cn/">@JustinYang</a> 大佬在滤波算法方面给予的援助。也十分感谢 <a href="https://punmy.cn/">@Punmy</a>、<a href="https://github.com/WuXiaoTu">@WuXiaoTu</a> 等作者的文章，使得后人能够少走很多弯路。</p><div class="tag-plugin tag link"><a class="link-card" title="心率管家&nbsp;App&nbsp;的设计与开发流程" href="/blog/2019-07-23-heartmate/"><div class="left"><span class="title">心率管家&nbsp;App&nbsp;的设计与开发流程</span><span class="url">/blog/2019-07-23-heartmate/</span></div><div class="right"><img src="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" class="lazyload" data-srcset="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div></a></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;在心率管家默默无闻地上线了一年多之后，现在终于打算来好好聊聊关于手机摄像头测量心率的那些事。本文参考了很多前辈的文章，将在文末列出。&lt;/p&gt;</summary>
    
    
    
    <category term="设计开发" scheme="https://xaoxuu.com/blog/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="iOS" scheme="https://xaoxuu.com/blog/tags/ios/"/>
    
    <category term="心率" scheme="https://xaoxuu.com/blog/tags/%E5%BF%83%E7%8E%87/"/>
    
  </entry>
  
  <entry>
    <title>静态博客使用 Issues API 动态发布友链、书签</title>
    <link href="https://xaoxuu.com/blog/2020-08-23-issues-api/"/>
    <id>https://xaoxuu.com/blog/2020-08-23-issues-api/</id>
    <published>2020-08-22T16:00:00.000Z</published>
    <updated>2021-02-19T05:48:12.088Z</updated>
    
    <content type="html"><![CDATA[<p>由于发布 issue 的成本远远低于发布一次博客更新（即便是使用了持续集成），可以用 issue 来简化每个独立博客都必备的友链系统，也可以通过 issue 来快速发布动态资讯，弥补静态博客必须更新静态文件才能更新内容的缺点。此功能已经集成到了主题中，使用非常方便。</p><a id="more"></a><h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><p>如标题所说，例如 Issues API 来实现，把请求到的结果进行解析，然后生成 HTML 标签，添加到页面中。为了获取到需要的信息，创建 Issue 需要遵循一定的格式，例如「网站卡片」就需要截图、网站标题、网站链接、网站描述、头像。可以设置 <a href="https://github.com/volantis-x/examples/issues/new/choose">Issues 模版</a> 来简化步骤。</p><p>通过 issue 方式发布内容可以支持 <code>script</code> 脚本，为了安全起见，最好设置一个限制，例如用标签来激活 <code>labels=active</code> 或者只对自己发布的有效，可以在解析数据的时候过滤掉 <code>script</code> 标签。</p><h2 id="如何在主题中使用？"><a href="#如何在主题中使用？" class="headerlink" title="如何在主题中使用？"></a>如何在主题中使用？</h2><p>在 GitHub 或者 Gitee 创建仓库，仿照下面的示例，把 api 中的用户名和仓库名改成自己的。Issue 内容中需要有一段满足 JSON 格式的代码块：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;screenshot&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avatar&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;版本：^4.0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>示例代码：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% issues sites api:https:&#x2F;&#x2F;api.github.com&#x2F;repos&#x2F;xaoxuu&#x2F;friends&#x2F;issues?sort&#x3D;updated&amp;state&#x3D;open&amp;page&#x3D;1&amp;per_page&#x3D;100&amp;labels&#x3D;active %&#125;</span><br></pre></td></tr></table></figure><p>上述示例对应的仓库链接：</p><div class="tag-plugin tag link"><a class="link-card" title="GitHub:&nbsp;xaoxuu/friends" href="https://github.com/xaoxuu/friends/issues"><div class="left"><span class="title">GitHub:&nbsp;xaoxuu/friends</span><span class="url">https://github.com/xaoxuu/friends/issues</span></div><div class="right"><img src="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" class="lazyload" data-srcset="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div></a></div><h2 id="在线演示效果"><a href="#在线演示效果" class="headerlink" title="在线演示效果"></a>在线演示效果</h2><p>见本站友链</p><div class="tag-plugin tag link"><a class="link-card" title="友链" href="/friends/"><div class="left"><span class="title">友链</span><span class="url">/friends/</span></div><div class="right"><img src="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" class="lazyload" data-srcset="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div></a></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;由于发布 issue 的成本远远低于发布一次博客更新（即便是使用了持续集成），可以用 issue 来简化每个独立博客都必备的友链系统，也可以通过 issue 来快速发布动态资讯，弥补静态博客必须更新静态文件才能更新内容的缺点。此功能已经集成到了主题中，使用非常方便。&lt;/p&gt;</summary>
    
    
    
    <category term="设计开发" scheme="https://xaoxuu.com/blog/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>个人电脑作为办公设备时如何保护隐私？</title>
    <link href="https://xaoxuu.com/blog/2020-06-27-privacy/"/>
    <id>https://xaoxuu.com/blog/2020-06-27-privacy/</id>
    <published>2020-06-26T16:00:00.000Z</published>
    <updated>2021-02-18T02:20:05.954Z</updated>
    
    <content type="html"><![CDATA[<p>公司一般都会强制安装安防软件，这些软件要求开机自启动，要求有屏幕录制权限、完全的磁盘访问权限包括相册图库。因此如果使用自己的 MacBook 作为办公设备，必须要把生活区和工作区完全独立开，安装在两个磁盘分区，并且对磁盘分区加密。</p><a id="more"></a><h2 id="分区加密"><a href="#分区加密" class="headerlink" title="分区加密"></a>分区加密</h2><p>对 Mac 电脑进行磁盘分区和安装多系统非常简单，打开「磁盘工具」点击标题栏的「分区」按钮进行分区即可，分区的格式一定要选择加密的，这里推荐「APFS（加密）」格式。密码要记下来防止遗忘。这里选择加密分区主要可以防止意外挂载：在启动了工作区的系统之后，由于需要密码才能挂载生活区的数据宗卷，可以有效避免不小心点了挂载或者设置了自动挂载，导致拥有完整的磁盘访问权限的安防软件自动扫描了生活区的文件资料。同样的道理，工作分区加密也可以防止生活区的某些软件扫描到了工作资料导致数据泄露。</p><div class="tag-plugin img-wrap"><div class="img-bg"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627d@2x.png" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627d@2x.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div></div><div class="tag-plugin img-wrap"><div class="img-bg"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627c@2x.png" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627c@2x.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div></div><p>分区完成之后，安装系统，目标宗卷选择刚刚新建的工作分区，剩下的系统安装步骤不需要赘述了。</p><h2 id="工作专用账号"><a href="#工作专用账号" class="headerlink" title="工作专用账号"></a>工作专用账号</h2><p>系统安装完成之后，最好登录工作专用的账号，不要使用同一个 AppleID 进行登录，否则仍然存在数据泄露的风险。同样的，浏览器账号也需要使用工作专用。AppleID 和浏览器账号基本上可以满足大部分需要记住账号密码的需求。</p><p>而对于工作日志，我推荐给程序员的做法是创建本地 git 仓库，用 <a href="https://typora.io/">Typora</a> 编辑器 markdown 格式书写。它的缺点十分有限，就是新增文件稍微麻烦一点，要在左侧目录树上点击右键，然后选择「新建文件」，然后输入文件名，除此之外几乎没有缺点。对于支持 md 的其它笔记软件来说，它对于 md 的支持比较完整，方便更换和修改主题，导出格式丰富并且样式也比较完整。</p><div class="tag-plugin img-wrap"><div class="img-bg"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627e@2x.png" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627e@2x.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Typora 操作界面"/></div><div class="image-meta"><span class="image-caption center">Typora 操作界面</span></div></div><h2 id="用户目录权限"><a href="#用户目录权限" class="headerlink" title="用户目录权限"></a>用户目录权限</h2><p>Mac 自带的一些用户文件目录例如「文稿」「桌面」等默认权限是 700 也就是仅当前用户可以读写和执行，但是自己新建的文件夹默认权限是 755 即全局用户都可以读取和执行。所以如果自己在原生的文件目录之外新建了文件夹，记得更改文件夹的权限：</p><div class="tag-plugin img-wrap"><div class="img-bg" style="background:#ECECEC"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627a@2x.jpg" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627a@2x.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="把权限由 755 修改为 700" style="width:500px;"/></div><div class="image-meta"><span class="image-caption center">把权限由 755 修改为 700</span></div></div><p>我切换了另一个用户进入这个用户目录时就提示无权限访问了，理论上这个用户上的应用程序也没有权限访问吧。（不太肯定）</p><div class="tag-plugin note" color="white"><div class="title"><strong>一个小坑</strong></div><div class="body"><p>经测试发现，在两个独立的宗卷中如果存在用户名和密码相同的两个用户，那么即使设置了 700 权限，但实际上在另一个宗卷中登录同名同密码的用户，对这个用户的文件夹一样拥有权限，不知道这是苹果有意为之还是设计漏洞。</p></div></div><h2 id="一个不便之处"><a href="#一个不便之处" class="headerlink" title="一个不便之处"></a>一个不便之处</h2><p>流程是进入系统后自动请求挂载另一个宗卷，由于开启了文件保险箱，所以弹出了密码输入框，不输入密码点击取消，则没有权限访问另一卷的磁盘内容。但是每次开机都会有这个弹窗，挺烦人的。</p><div class="tag-plugin img-wrap"><div class="img-bg"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627f@2x.png" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2020-0627f@2x.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="width:540px;"/></div></div><p>网上搜索了设置开机不自动挂载的方法，都是修改 <code>fstab</code> 文件的方法：</p><figure class="highlight md"><figcaption><span>/etc/fstab</span></figcaption><table><tr><td class="code"><pre><span class="line">UUID=427478BB-E267-4455-869A-4AAB54F792A1 none auto noauto 0 0</span><br></pre></td></tr></table></figure><p>实测无效，每次登录用户还是会自动尝试挂载，可能这种方式在 APFS 分区中不再支持了。不知道在 2020 年，如何让 APFS 加密分区不自动挂载？</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;公司一般都会强制安装安防软件，这些软件要求开机自启动，要求有屏幕录制权限、完全的磁盘访问权限包括相册图库。因此如果使用自己的 MacBook 作为办公设备，必须要把生活区和工作区完全独立开，安装在两个磁盘分区，并且对磁盘分区加密。&lt;/p&gt;</summary>
    
    
    
    <category term="日常生活" scheme="https://xaoxuu.com/blog/categories/%E6%97%A5%E5%B8%B8%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="Mac" scheme="https://xaoxuu.com/blog/tags/mac/"/>
    
  </entry>
  
  <entry>
    <title>苹果设计开发加速器《创建卓越的 Apple Watch 体验》活动体验</title>
    <link href="https://xaoxuu.com/blog/2019-10-06-ios-apple-watch/"/>
    <id>https://xaoxuu.com/blog/2019-10-06-ios-apple-watch/</id>
    <published>2019-10-05T16:00:00.000Z</published>
    <updated>2021-02-19T04:21:29.237Z</updated>
    
    <content type="html"><![CDATA[<p>9月26号收到了苹果的一活动邀请邮件《创建卓越的 Apple Watch 体验》，活动地点是：Design and Development Accelerator，这是苹果今年7月份在上海设立的设计开发加速器，为开发者提供有关应用设计与开发的专业培训和资源。</p><a id="more"></a><details class="tag-plugin" ><summary><span>什么是「设计开发加速器」？</span></summary><div class="body"><ul><li>苹果官网：<a href="https://developer.apple.com/cn/accelerator/">设计开发加速器</a></li><li>视频体验：<a href="https://www.bilibili.com/video/av58500736/?spm_id_from=333.788.videocard.7">搞机零距离：中国开发者的大好事？苹果工程师一对一授课，让人开了又开？</a></li><li>媒体资讯：<a href="https://sspai.com/post/55613">苹果设计开发加速器正式启动，每年计划为 5000 名国内开发者提供支持</a></li></ul></div></details><h2 id="watchOS-6"><a href="#watchOS-6" class="headerlink" title="watchOS 6"></a>watchOS 6</h2><p>构建面向 watchOS 的 app，让用户随时随地及时掌握信息并轻松完成快速操作。开放了更多种全新的 API，可以构建完全独立的 watchOS app，甚至是不带有 iOS 版的 watchOS app。现在，用户可以直接在 Apple Watch 上的 App Store 中查找并安装 app。</p><h2 id="独立的-App"><a href="#独立的-App" class="headerlink" title="独立的 App"></a>独立的 App</h2><p>在 watchOS 6 中，可以构建完全独立的 Watch App。“Sign in with Apple” 让用户远离手机时也能在 Apple Watch 上登录 app。</p><div class="tag-plugin img-wrap"><div class="img-bg" style="background:white"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/mirror/apple/documentation/watchkit/af79db6d-02b1-4df0-9f46-6c3c9db12d76.png" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/mirror/apple/documentation/watchkit/af79db6d-02b1-4df0-9f46-6c3c9db12d76.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="选择应用模板" style="width:500px;padding:16px;"/></div><div class="image-meta"><span class="image-caption center">选择应用模板</span></div></div><ul><li><p><strong>Watch-only app</strong><br>创建只有 Apple Watch 且没有相关 iOS 应用程序。</p></li><li><p><strong>watchOS app with an iOS app</strong><br>当您拥有 iOS 应用并想要提供可提供相似或相关体验的 watchOS 应用。</p></li></ul><p>在创建 watchOS Target 时，指定要构建的 watchOS 项目的类型。此外，如果将 watchOS 应用程序与 iOS 应用程序捆绑在一起，则必须指定 watchOS 应用程序如何与其配套的 iOS 应用互动。</p><ul><li><strong>Independent Apps</strong> （独立应用）不需要 iOS 配套应用即可正常运行。用户可以选择安装 iOS 应用、watchOS 应用或同时安装两者。</li><li><strong>Dependent Apps</strong> （从属应用）依靠 iOS 配套应用才能正常运行；仅在 watchOS 应用需要与 iOS 应用互动时才创建从属应用。用户必须使用其 iOS 应用购买并安装从属的 watchOS 应用。</li></ul><blockquote><p>在 watchOS 5 和更低版本中，所有 watchOS 应用程序都是从属应用。</p></blockquote><h2 id="Apple-Watch-上的-App-Store"><a href="#Apple-Watch-上的-App-Store" class="headerlink" title="Apple Watch 上的 App Store"></a>Apple Watch 上的 App Store</h2><p>watchOS 6 上提供适用于 Apple Watch 的 App Store，让用户可以直接在 Apple Watch 上轻松探索、浏览、搜索和安装 watchOS app。使用 Siri、听写或涂写进行搜索，或者通过轻点产品页面链接，直接进入产品页面。</p><div class="tag-plugin img-wrap"><div class="img-bg" style="background:white"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/mirror/apple/documentation/watchkit/06d45110-1dd7-49a4-a413-9f5159ecdd0e.png" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/mirror/apple/documentation/watchkit/06d45110-1dd7-49a4-a413-9f5159ecdd0e.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="width:180px;padding:16px;"/></div></div><p>系统会为独立和从属应用直接将 watchOS 应用程序下载并安装到 Apple Watch。</p><h2 id="Apple-Watch-人机界面指南"><a href="#Apple-Watch-人机界面指南" class="headerlink" title="Apple Watch 人机界面指南"></a>Apple Watch 人机界面指南</h2><p>Apple Watch 设计为可穿戴，因此用户界面适合穿戴者使用，并为他们带来轻巧，反应灵敏且高度个性化的体验。人们经常使用 watchOS 应用程序的相关体验（例如复杂功能、通知和 Siri 交互），而不是使用应用程序本身。创造出色的 watchOS 体验意味着既要设计应用程序，又要设计快速，信息丰富的元素，使人们能够以适合自己的方式访问您的内容。最有用的应用通常：</p><ul><li>使用复杂功能可以在表盘上提供少量可能动态的信息，使人们可以一目了然地查看信息</li><li>使用通知传递及时的高价值信息并采取重要行动</li><li>帮助人们使用 Siri 获取信息并执行任务</li><li>如有必要，请在应用程序体验中提供更多详细信息和功能</li></ul><div class="tag-plugin img-wrap"><div class="img-bg" style="background:white"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/mirror/apple/design/human-interface-guidelines/watchos/watchOS-hero.svg" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/mirror/apple/design/human-interface-guidelines/watchos/watchOS-hero.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="width:320px;padding:16px;"/></div></div><br><div class="tag-plugin note" color="blue"><div class="title"><strong>图片来源声明</strong></div><div class="body"><p>本文挖了坑但是许久没有填上，直到 watchOS 7 都要发布了，最后决定放弃填坑，文章封面和文中的部分插图来源于苹果官方文档。</p></div></div><details class="tag-plugin" ><summary><span>附：议程安排</span></summary><div class="body"><div class="tag-plugin img-wrap"><div class="img-bg" style="background:#F3F2F7"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2019-1006a@2x.jpg" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2019-1006a@2x.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="width:400px;padding:16px;"/></div></div><p>苹果上海设计开发加速器地点在源深体育中心地铁站4出口处，三座非常低调没有任何招牌的建筑，绕着走了一圈才找到A座二楼入口的门。内部环境如媒体图片一样，室内禁止私自拍照，只有这张门票留作纪念喽。</p><div class="tag-plugin img-wrap"><div class="img-bg" style="background:#857E74"><img class="img lazyload" src="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2019-1006b@2x.jpg" class="lazyload" data-srcset="https://gitee.com/xaoxuu/cdn-assets/raw/master/blog/2019-1006b@2x.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="width:400px;padding:16px;"/></div></div></div></details>]]></content>
    
    
    <summary type="html">&lt;p&gt;9月26号收到了苹果的一活动邀请邮件《创建卓越的 Apple Watch 体验》，活动地点是：Design and Development Accelerator，这是苹果今年7月份在上海设立的设计开发加速器，为开发者提供有关应用设计与开发的专业培训和资源。&lt;/p&gt;</summary>
    
    
    
    <category term="技术简讯" scheme="https://xaoxuu.com/blog/categories/%E6%8A%80%E6%9C%AF%E7%AE%80%E8%AE%AF/"/>
    
    
    <category term="iOS" scheme="https://xaoxuu.com/blog/tags/ios/"/>
    
  </entry>
  
  <entry>
    <title>心率管家 App 的设计与开发流程</title>
    <link href="https://xaoxuu.com/blog/2019-07-23-heartmate/"/>
    <id>https://xaoxuu.com/blog/2019-07-23-heartmate/</id>
    <published>2019-07-22T16:00:00.000Z</published>
    <updated>2021-02-20T10:28:13.465Z</updated>
    
    <content type="html"><![CDATA[<p>近期开发并上架了新版心率管家 App（仅 iOS 端），专业版不定期限免，欢迎下载体验。本文将从设计、开发、上架等每个步骤和细节进行分享，也包含部分模块源码。</p><a id="more"></a><div class="tag-plugin tag link"><a class="link-card" title="心率管家" href="https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1"><div class="left"><span class="title">心率管家</span><span class="url">https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1</span></div><div class="right"><img src="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" class="lazyload" data-srcset="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div></a></div><h2 id="立项"><a href="#立项" class="headerlink" title="立项"></a>立项</h2><h3 id="确定需求"><a href="#确定需求" class="headerlink" title="确定需求"></a>确定需求</h3><p>立项的初衷是满足随时测心率的需求（没有智能手环手表的人群），App 核心功能就是测量心率，围绕这个功能展开的是测量时更多细节的记录、对已有数据的筛选。再往深度挖掘的是数据分析、健康预测。</p><h3 id="市场考察"><a href="#市场考察" class="headerlink" title="市场考察"></a>市场考察</h3><p>虽然 AppStore 已有，但是无一例外都特别丑，要么收费要么有广告，所以不如自己做一个。</p><h3 id="测量原理"><a href="#测量原理" class="headerlink" title="测量原理"></a>测量原理</h3><p><strong>光电容积脉搏波描记法（PPG）</strong></p><p>是追踪可见光（通常为绿光）在人体组织中的反射。它具备一个可见光光源来照射皮肤，再使用光电传感器采集被皮肤反射回来的光线。PPG 有两种模式，透射式和反射式，像一般的手环手表这样，光源和传感器在同一侧的，就是反射式；而医院中常见的夹在指尖上的通常是透射式的，即光源和传感器在不同侧。 皮肤本身对光线的反射能力是相对稳定的，但是心脏泵血使得血管容积周期性地变化，导致反射光也呈现出周期性的波动值，特别是在指尖这种毛细血管非常丰富的部位，这种周期性的波动很容易被观察到。</p><p>Wikipedia: <a href="https://en.wikipedia.org/wiki/Photoplethysmogram">#Photoplethysmogram</a></p><p>对应到 App 上就是通过分析摄像头每一帧画面的色值，计算出颜色波动的频率，即为近似心率。</p><h3 id="定价策略"><a href="#定价策略" class="headerlink" title="定价策略"></a>定价策略</h3><ul><li>付费版：价格波动，通过降价和限免吸引爬虫收录。</li><li>免费版：限制了部分个性化功能，核心功能不受影响，没有任何广告。</li></ul><h3 id="技术方案"><a href="#技术方案" class="headerlink" title="技术方案"></a>技术方案</h3><p>语言：Swift5<br>设计模式：MVC<br>路由方案：JLRoutes<br>主题和UI管理：Inspire<br>缓存方案：SQLite<br>数据同步方案：暂定AppleHealth</p><h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p>初期使用 Sketch 制作效果图，在后期直接在项目中进行调整，没有再更新到 Sketch 中。下面这是最终发布到 AppStore 的应用截图：</p><div class="tag-plugin swiper-container" width="min"><div class="swiper-wrapper"><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot01.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot01.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot02.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot02.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot03.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot03.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot04.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot04.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot05.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot05.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot06.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot06.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div></div><h2 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h2><h3 id="心率测量组件"><a href="#心率测量组件" class="headerlink" title="心率测量组件"></a>心率测量组件</h3><p>心率测量功能开发为一个私有库，具体实现稍后补充。。。</p><h3 id="可定制UI"><a href="#可定制UI" class="headerlink" title="可定制UI"></a>可定制UI</h3><p>使用 <a href="https://xaoxuu.com/wiki/inspire/">Inspire</a> 作为主题管理器，目前暂未支持主题切换，后续更新会加入。</p><h3 id="快捷指令"><a href="#快捷指令" class="headerlink" title="快捷指令"></a>快捷指令</h3><p>使用 JLRoutes 路由方案，目前支持 URLSchemes 启动并开始测量，可接受两个参数：</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 直接启动</span></span><br><span class="line">heartmatepro:<span class="comment">//record</span></span><br><span class="line"><span class="comment">// 自定义补光灯亮度（亮度值 l 为浮点数，取值范围是0~1）</span></span><br><span class="line">heartmatepro:<span class="comment">//record?l=0.3</span></span><br><span class="line"><span class="comment">// 自定义补光灯亮度和测量样本容器大小（样本容器大小 c 为正整数，取值范围是1~20）</span></span><br><span class="line">heartmatepro:<span class="comment">//record?l=0.1&amp;c=10</span></span><br></pre></td></tr></table></figure><p>免费版限制了自定义亮度，但是你依然可以通过这种方式来自定义。</p><h3 id="ProHUD"><a href="#ProHUD" class="headerlink" title="ProHUD"></a>ProHUD</h3><p>使用 <a href="https://xaoxuu.com/wiki/prohud/">ProHUD</a> 来负责弹窗和操作表，包括隐私政策页面。</p><div class="tag-plugin swiper-container" width="min"><div class="swiper-wrapper"><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot21.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot21.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot22.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot22.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot23.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot23.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot24.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot24.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div><div class="swiper-slide"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot25.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/proj/heartmate/screenshot25.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div></div><h2 id="上架"><a href="#上架" class="headerlink" title="上架"></a>上架</h2><p>新建应用，填写名称、BundleId 等资料，然后在 App 页面填写描述、网址、隐私政策链接、上传截图、确定分级……</p><p>待应用通过 testflight 测试无误后，打包上传。然后过几分钟 appstoreconnect 页面就可以选中刚才上传的包了，然后提交审核，第二天就审核通过。（现在 AppStore 新应用审核也太快了）</p><div class="tag-plugin tag link"><a class="link-card" title="App&nbsp;Store&nbsp;Connect" href="https://appstoreconnect.apple.com"><div class="left"><span class="title">App&nbsp;Store&nbsp;Connect</span><span class="url">https://appstoreconnect.apple.com</span></div><div class="right"><img src="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" class="lazyload" data-srcset="https://7.dusays.com/2021/02/20/8f277b4ee0ecd.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div></a></div><h2 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h2><h3 id="数据价值"><a href="#数据价值" class="headerlink" title="数据价值"></a>数据价值</h3><p>后续迭代中会在测量详情页面下方的留白处加上【标签】、【备注】、【数据分析】模块，前两者利于检索数据，数据分析目前没有能力独自完成，计划使用第三方服务。</p><h3 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h3><p><strong>图标</strong><br>这是一次彻底重做，所以也可以算是初版。很多细节还比较粗糙，例如图标没有经过打磨，设置列表连图标都没有。</p><p><strong>占位图</strong><br>很多页面在没有数据的时候也没有占位的图片，这个也会慢慢完善。</p><p><strong>心率区间</strong><br>心率卡片的颜色、心率卡片右上角以及归档页面心率的底部的彩色长条代表的是当前所处的心率区间，App 中并没有说明，后续迭代中也会完善这里。并且心率区间的划分需要年龄和性别，这个也会在后期进行完善。</p><h2 id="附：开源库"><a href="#附：开源库" class="headerlink" title="附：开源库"></a>附：开源库</h2><p>App 不开源，但是 App 使用的很多模块是开源的，自己开发的模块也上传至 GitHub 了。（App 的关于页面可以看到）</p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/xaoxuu/ProHUD"><img src="https://github-readme-stats.vercel.app/api/pin/?username=xaoxuu&repo=ProHUD&&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=xaoxuu&repo=ProHUD&&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></a></div> <div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/xaoxuu/Inspire"><img src="https://github-readme-stats.vercel.app/api/pin/?username=xaoxuu&repo=Inspire&&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=xaoxuu&repo=Inspire&&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></a></div><p><strong>第三方库：</strong></p><table><thead><tr><th align="left">第三方库</th><th align="left">功能</th></tr></thead><tbody><tr><td align="left">RxSwift</td><td align="left">响应式编程框架</td></tr><tr><td align="left">JLRoutes</td><td align="left">路由</td></tr><tr><td align="left">SnapKit</td><td align="left">自动布局</td></tr><tr><td align="left">SQLite.swift</td><td align="left">SQLite数据库管理</td></tr><tr><td align="left">STDPickerView</td><td align="left">选择器控件</td></tr><tr><td align="left">Bugly</td><td align="left">BUG追踪</td></tr></tbody></table><p><strong>第三方服务：</strong></p><table><thead><tr><th align="left">第三方服务</th><th align="left">功能</th></tr></thead><tbody><tr><td align="left"><a href="https://unsplash.com/">Unsplash</a></td><td align="left">免费图片</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;p&gt;近期开发并上架了新版心率管家 App（仅 iOS 端），专业版不定期限免，欢迎下载体验。本文将从设计、开发、上架等每个步骤和细节进行分享，也包含部分模块源码。&lt;/p&gt;</summary>
    
    
    
    <category term="设计开发" scheme="https://xaoxuu.com/blog/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="iOS" scheme="https://xaoxuu.com/blog/tags/ios/"/>
    
    <category term="Swift" scheme="https://xaoxuu.com/blog/tags/swift/"/>
    
  </entry>
  
</feed>
